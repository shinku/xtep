/**
 * Created by shin on 2018/1/4.
 */
function EventDispatcher(){var registorPool={};var registorPoolvision="1.0";var self=this;this.addEventListener=function(eventtype,fun){if(!registorPool[eventtype]){registorPool[eventtype]=new Array}var arr=registorPool[eventtype];var isContain=false;for(var i=0;i<arr.length;i++){if(arr[i]==fun){isContain=true;break}}if(!isContain&&fun&&typeof fun=="function")registorPool[eventtype].push(fun)};this.dispatchEvent=function(event,fn){if(registorPool[event.type]){var arr=registorPool[event.type];var isMatch=false;for(var i=0;i<arr.length;i++){event.target=self;if(fn&&fn==arr[i]){isMatch=true}}if(isMatch){fn(event.data)}else if(fn&&!isMatch){alert("未先监听"+fn.getName()+"方法")}else{for(var i=0;i<arr.length;i++){arr[i](event.data)}}}};this.removeEventListener=function(eventtype,fun){if(registorPool[eventtype]){var arr=registorPool[eventtype];for(var i=0;i<arr.length;i++){if(arr[i]==fun){arr.splice(i,1)}}}}}function Event(type,data){this.type=type;this.data=data;this.target=null}Function.prototype.getName=function(){return this.name||this.toString().match(/function\s*([^(]*)\(/)[1]};var isAndroid=function(){return/(Android)/i.test(navigator.userAgent)}();var isDom=function(e){if(typeof e=="object"&&e instanceof HTMLElement){return true}return false};var isJQ=function(e){if(window.jQuery&&typeof e=="object"&&e instanceof jQuery){return true}return false};var isLdDom=function(e){if(typeof e=="object"&&e instanceof HTMLElement){var type=e.nodeName.toLowerCase();if(type=="img"||type=="video"||type=="audio"){return true}}return false};var isLdCompleteList=function(e){if(typeof e=="object"&&"sort"in e){var _obj=e[0];if("src"in _obj&&"e"in _obj){return true}}return false};var getDomType=function(e){return e.nodeName.toLowerCase()};Array.prototype.getImgList=function(){var _imgList=[];for(val in this){var _obj=this[val];if("src"in _obj&&"e"in _obj)_imgList.push(_obj.e)}return _imgList};var MF_Loading=function(){function MF_Loading(p){EventDispatcher.call(this);function setDomList(domlist,type){var stack=[];for(var m=0;m<domlist.length;m++){var _src=domlist[m].getAttribute(_s.srcNames);if(_src){stack.push(_s.addLDstack({type:type,src:_src,e:domlist[m]}))}}return stack}function setAddList(arry){var stack=[];for(var n=0;n<arry.length;n++){stack.push(_s.addLDstack(arry[n]))}return stack}function getDomList(o){var imglist=o.getElementsByTagName("img");var vdlist=o.getElementsByTagName("video");var adlist=o.getElementsByTagName("audio");var data1=setDomList(imglist,"img");var data2=setDomList(vdlist,"video");var data3=setDomList(adlist,"audio");return data1.concat(data2,data3)}function getJqList(o,list){var data=[];var imglist=o.find("img");var vdlist=o.find("video");var adlist=o.find("audio");var data1=setDomList(imglist,"img");var data2=setDomList(vdlist,"video");var data3=setDomList(adlist,"audio");return data1.concat(data2,data3)}var _s=this;var addLoadObject=function(o){if(isDom(o)){if(isLdDom(o)){var type=getDomType(o);if(type=="img"||type=="video"||type=="audio"){return setDomList([o],type)}}else{return getDomList(o)}}else if(isJQ(o)){var type=getDomType(o[0]);if(type=="img"||type=="video"||type=="audio"){return setDomList(o,type)}else{return getJqList(o)}}else if(typeof o==="object"){if(o.src&&o.type){return[_s.addLDstack(o)]}else if(typeof o.sort=="function"){return setAddList(o)}}};var init=function(){for(var m=0;m<_s.list.length;m++){(function(){var n=m;var _LDobj=_s.list[n];_LDobj.status=0;_LDobj.count=0;if(_LDobj.type=="img"){if(!_LDobj.e){_LDobj.e=new Image}_LDobj.e.onload=function(){_LDobj.status=1;_s.removeLD(_LDobj)}}else if(_LDobj.type=="audio"||_LDobj.type=="video"){if(!_LDobj.e){if(_LDobj.type=="audio"){_LDobj.e=document.createElement("audio")}else{_LDobj.e=document.createElement("video")}}if(!isAndroid||_LDobj.type!="video"){_LDobj.e.addEventListener("canplaythrough",function(){_LDobj.status=1;_s.removeLD(_LDobj)})}}_LDobj.load=function(){_LDobj.count++;_LDobj.e.src=_LDobj.src;if(_LDobj.type=="video"||_LDobj.type=="audio"){_LDobj.e.load()}};_LDobj.e.onerror=function(){if(_LDobj.count<_s.errorCount){_LDobj.status=2;_LDobj.load()}else{_LDobj.status=3;_s.removeLD(_LDobj)}}})()}};var upDate=function(val){if(_s.loadUp)_s.loadUp(val);_s.dispatchEvent(new Event("update",val))};this.srcNames=p.srcNames?p.srcNames:"alts";this.loadUp=typeof p.LDup==="function"?p.LDup:null;this.callback=typeof p.LDsuccess==="function"?p.LDsuccess:null;this.list=[];this.suclist=[];this.set=null;this.timers=30;this.length=null;this.errorCount=3;this.start=function(){init();_s.length=_s.getLength();_s.loads();var speed=0,up=function(){var LDprogress=parseInt(_s.suclist.length/_s.length*100);if(LDprogress<=100){if(p.LDtween&&speed<LDprogress){speed++}else{speed=LDprogress}upDate(speed);if(speed==100){clearInterval(_s.set);if(_s.callback)_s.callback();_s.dispatchEvent(new Event("complete",speed))}}};this.set=setInterval(up,_s.timers)};this.add=function(o){if(o){return addLoadObject(o)}};this.addLDstack=function(o){var isLD=_s.isLoad(o.e);if(isLD){return isLD}else{var length=_s.list.push(o);return _s.list[length-1]}};this.addImgSheet=function(){var arg=arguments[0],_list=[];for(var i=arg.start;i<arg.length;i+=arg.step){_list.push({type:"img",src:arg.imgPrefix+(i<10?"0"+i:i)+"."+arg.imgType})}return setAddList(_list)};this.isLoad=function(e){for(var m=0;m<_s.list.length;m++){if(e&&_s.list[m].e==e){return _s.list[m]}}return false};this.loads=function(){for(var m=0;m<_s.list.length;m++){_s.list[m].load();if(isAndroid&&_s.list[m].type=="video"){_s.list[m].status=1;_s.removeLD(_s.list[m]);m--}}};this.getLength=function(){return _s.list.length};this.removeLD=function(o){var n=0;while(n<_s.list.length){if(_s.list[n]==o){_s.suclist.push(o);_s.list.splice(n,1);break}n++}};this.main=function(){if(p.LDpage){getDomList(document);return false}if(p.LDdom){addLoadObject(p.LDdom)}upDate(0)};this.main()}return MF_Loading}();var MF_animateImages=function(){var rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},cssPrefixes=["Webkit","O","Moz","ms"];function camelCase(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)}function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}var setOp=function(o,_v){if(o.runtimeStyle){if(typeof o.runtimeStyle["opacity"]==="undefined"){o.style.filter="alpha(opacity="+_v*100+")"}else{o.runtimeStyle["opacity"]=_v}}else{o.style["opacity"]=_v}};function animateImages(p){EventDispatcher.call(this);var self=this;if(p.imgList.length>0){this.width=p.width?p.width:p.imgList[0].width;this.height=p.height?p.height:p.imgList[0].height}if(isDom(p.parents))this.parents=p.parents;else if(isJQ(p.parents))this.parents=p.parents[0];this.anmtList=p.imgList;this.type=p.type?p.type:"canvas";this.step=p.step;this.times=p.times;this.ITV=null;this.startIndex=0;this.endIndex;this.progress=0;this.loop=p.loop;this.up=null;this.drawImages=function(){};this.clear=function(){};this.toProgress=function(n){this.progress=n;this.drawImages(n)};this.setStart=function(n){self.startIndex=n;self.toProgress(n)};this.setEnd=function(n){if(n>self.length)self.endIndex=self.length;else self.endIndex=n};this.play=function(){self.ITV=setInterval(function(){self.progress+=self.step;if(self.progress>=self.endIndex)if(self.loop)self.progress=self.startIndex;else{self.stop();self.dispatchEvent(new Event("complete",self.progress));return}self.toProgress(self.progress);self.dispatchEvent(new Event("update",self.progress));self.dispatchEvent(new Event(self.progress,self.progress))},self.times)};this.stopActivity=function(){if(self.ITV){clearInterval(self.ITV);self.ITV=null}};this.pause=function(){self.stopActivity()};this.stop=function(){self.stopActivity();self.progress=self.startIndex};this.creatElment=function(name){return document.createElement(name)};this.setCssObj=function(o,jsons){for(name in jsons){self.css(o,name,jsons[name])}};this.css=function(obj,_s,_v){if(typeof _s==="undefined"||!_s)return false;if(typeof _s==="object"){self.setCssObj(obj,_s);return false}var origName=camelCase(_s);var style=obj.style;var name=vendorPropName(style,origName);if(name=="opacity"){setOp(obj,_v);return}if(typeof _v==="undefined"){if(obj.style[name]!=""){return obj.style[name]}else if(window.getComputedStyle){return window.getComputedStyle(obj,null)[name]}else if(obj.currentStyle){return obj.currentStyle[name]}else{return"auto"}}else{if(obj.runtimeStyle){obj.runtimeStyle[name]=_v}else{obj.style[name]=_v}}};this.remove=function(){while(self.parents.hasChildNodes()){self.parents.removeChild(self.parents.firstChild)}}}return animateImages}();function MF_animateSheet(p){if(isLdCompleteList(p.imgList)){p.imgList=p.imgList.getImgList()}else{p.imgList=[]}this.length=p.imgList.length;MF_animateImages.call(this,p);var self=this;if(self.type=="canvas"){this.canvas=self.creatElment("canvas");this.canvas.width=this.width;this.canvas.height=this.height;this.parents.appendChild(this.canvas);var ctx=self.canvas.getContext("2d");this.drawImages=function(n){self.clear();ctx.drawImage(self.anmtList[n],0,0)};this.clear=function(){ctx.clearRect(0,0,self.width,self.height)}}else if(self.type=="img"){this.drawImages=function(n){self.clear();self.parents.appendChild(self.anmtList[n])};this.clear=function(){while(self.parents.hasChildNodes()){self.parents.removeChild(self.parents.firstChild)}}}this.main=function(){self.endIndex=self.length;self.toProgress(self.progress)};this.main()}function MF_animateSprite(p){if(isDom(p.imgList)){p.imgList=[p.imgList]}else if(isLdCompleteList(p.imgList)){p.imgList=p.imgList.getImgList()}else if(!isJQ(p.imgList)){p.imgList=[]}this.length=p.row*p.column;MF_animateImages.call(this,p);var self=this;var _img=self.anmtList[0];console.log(_img);this.getPosition=function(n){return{x:-(n%p.column*self.width),y:-(parseInt(n/p.column)*self.height)}};if(self.type=="canvas"){this.remove();this.canvas=self.creatElment("canvas");this.canvas.width=this.width;this.canvas.height=this.height;this.parents.appendChild(this.canvas);var ctx=self.canvas.getContext("2d");var imgW=_img.width;var imgH=_img.height;this.drawImages=function(n){self.clear();var _position=self.getPosition(n);ctx.drawImage(_img,_position.x,_position.y,imgW,imgH)};this.clear=function(){ctx.clearRect(0,0,self.width,self.height)}}else if(self.type=="img"){var box=self.creatElment("div");self.css(box,{position:"absolute",top:0,left:0,width:self.width+"px",height:self.height+"px",overflow:"hidden"});self.parents.appendChild(box);box.appendChild(_img);self.css(_img,{position:"absolute",top:0,left:0});this.drawImages=function(n){var _position=self.getPosition(n);self.css(_img,{top:_position.y+"px",left:_position.x+"px"})};this.clear=function(){while(self.parents.hasChildNodes()){self.parents.removeChild(self.parents.firstChild)}}}this.main=function(){self.endIndex=self.length;self.toProgress(self.progress)};this.main()}var MF_CONFIG_CENTER={appUrlConfig:{},DATA_OBJ:{},configNet:function(excutename,object){MF_CENTER.appUrlConfig[excutename]=object;MF_CENTER.DATA_OBJ[excutename]=object}};function MF_NetApp(){EventDispatcher.call(this);var self=this;var EVENT_OBJ=MF_CONFIG_CENTER.DATA_OBJ;this.init=function(){for(i in EVENT_OBJ){self.addEventListener(i,EVENT_OBJ[i].success)}};this.getData=function(typeName,jsonData,fn){for(i in EVENT_OBJ){if(typeName==i){if(EVENT_OBJ[i].url&&EVENT_OBJ[i].url!=""){self.DoAjax(EVENT_OBJ[i],typeName,jsonData,fn)}else{self.runEvent(typeName,jsonData,fn)}}}};this.runEvent=function(typeName,Data,fn){self.dispatchEvent(new Event(typeName,Data),fn)};this.DoAjax=function(opts,typeName,jsonData,fn){var defaultsOpts={type:"POST",async:false,url:"",dataStringify:false,data:null,dataType:"json",successDecode:false,success:null,error:function(){alert("网络不给力，再试下吧！")},complete:null};if(jsonData)opts=$.extend({},defaultsOpts,opts);if(opts.dataStringify==true&&opts.data){opts.data=JSON.stringify(opts.data)}if(jsonData){if(opts.dataStringify==true){opts.data=JSON.stringify(jsonData)}else{opts.data=jsonData}}$.ajax({type:opts.type,async:opts.async,url:opts.url,data:opts.data,dataType:opts.dataType,success:function(d){if(opts.successDecode&&d.Data&&d.Data!=""){d.Data=eval("["+html_decode(d.Data)+"]")[0]}if(typeof d=="string"){d=JSON.parse(d)}self.runEvent(typeName,d,fn)},error:opts.error,complete:opts.complete})}}var MF_vfile={input:null,file:null,data:null,init:function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){console.log("Great success! All the File APIs are supported.")}else{console.log("The File APIs are not fully supported in this browser.");alert("你使用的浏览器不支持文件本地上传。请更新你的浏览器");return}this.input=document.createElement("input");this.input.type="file";this.input.onchange=this.fileSelect;this.file=new window.FileReader;this.file.onload=function(e){console.log("载入VFILE资源完毕");vfile.data=e.target.result;vfile.onLoaded(vfile.data)}},loadFile:function(){if(document.all){this.input.click()}else{var e=document.createEvent("MouseEvents");e.initEvent("click",true,true);this.input.dispatchEvent(e)}},getFile:function(){},showFileDir:function(){},fileSelect:function(e){var target=e.target||window.event.srcElement;var filedata=vfile.input.files[0];if(!filedata){console.log("没有选择文件");vfile.onError();return}else{vfile.file.readAsDataURL(filedata);console.log("载入VFILE资源")}},onLoaded:function(result){console.log(result)},onError:function(){}};MF_vfile.init();var MF_DEVICE={TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",devicetype:"mobile",check:function(){var mydeviceinfotmation=navigator.userAgent.toLowerCase();if(mydeviceinfotmation.match(/ipad/i)=="ipad"){}else if(mydeviceinfotmation.match(/iphone/i)=="iphone"){}else if(mydeviceinfotmation.match(/android/i)=="android"){}else if(mydeviceinfotmation.match(/windows mobile/i)=="windows mobile"){this.TOUCH_START="mousedown";this.TOUCH_MOVE="mousemove";this.TOUCH_END="mouseup"}else{this.TOUCH_START="mousedown";this.TOUCH_MOVE="mousemove";this.TOUCH_END="mouseup"}}};MF_DEVICE.check();function MF_FaceTouch(targetElement){EventDispatcher.call(this);MF_DEVICE.check();this.element=document.getElementById(targetElement)||document.body;var isTouch=false;var touchpoints;this.name="xiaoxin";this.onmove=function(){};this.onrotate=function(){};this.ontouchend=function(){};this.initdis=0;this.initrotation=0;var self=this;var pointsnumber=0;var lastp;this.lastdis=0;this.lastrotation=0;var self=this;this.handleTouchBegin=function(e){e.preventDefault();isTouch=true;var str="";for(var o in e){str+=o+"="+e[o]+"\n"}if(e.targetTouches){var touchnum=e.targetTouches.length;pointsnumber++;switch(touchnum){case 1:lastp=touchpoints=[{x:e.targetTouches[0].pageX,y:e.targetTouches[0].pageY}];break;case 2:touchpoints=[{x:e.targetTouches[0].pageX,y:e.targetTouches[0].pageY},{x:e.targetTouches[1].pageX,y:e.targetTouches[1].pageY}];self.initdis=caculatepointsDistance(touchpoints[0],touchpoints[1]).offsetdistance;self.initrotation=caculatepointsDistance(touchpoints[0],touchpoints[1]).angle/Math.PI*180;break}self.element.addEventListener("touchmove",self.handleTouchMove)}else{touchpoints=lastp=[{x:e.pageX,y:e.pageY}];self.element.addEventListener("mousemove",self.handleTouchMove)}};this.handleMouchMove=function(e){if(isTouch){var newtouch;consoloe.log(e.clientX);newtouchs=[{x:e.clientX,y:e.clientY}];handleTouchesByOnePoint(newtouchs,touchpoints)}};this.handleMouseBegin=function(e){isTouch=true;touchpoints=[{x:e.clientX,y:e.clientY}]};this.handleTouchMove=function(e){if(isTouch){if(e.targetTouches){var touchnum=e.targetTouches.length;var newtouchs;switch(touchnum){case 1:newtouchs=[{x:e.targetTouches[0].pageX,y:e.targetTouches[0].pageY}];handleTouchesByOnePoint(newtouchs,touchpoints);break;case 2:newtouchs=[{x:e.targetTouches[0].pageX,y:e.targetTouches[0].pageY},{x:e.targetTouches[1].pageX,y:e.targetTouches[1].pageY}];handleTouchsByMultiPoints(newtouchs,touchpoints);break}}else{newtouchs=[{x:e.pageX,y:e.pageY}];handleTouchesByOnePoint(newtouchs,touchpoints)}}touchpoints=newtouchs};this.handleTouchEnd=function(e){isTouch=false;pointsnumber=0;self.initdis=self.lastdis;self.initrotation=self.lastrotation;self.ontouchend(lastp);self.dispatchEvent(new Event("tapend",lastp));self.element.removeEventListener(MF_DEVICE.TOUCH_MOVE,self.handleTouchMove)};function handleTouchesByOnePoint(points1,points2){var p=caculatepointsDistance(points1[0],points2[0]);lastp=p;if(self.onmove){self.onmove(p)}self.dispatchEvent(new Event("tapmove",p))}function handleTouchsByMultiPoints(points1,points2){var result1=caculatepointsDistance(points1[0],points1[1]);var result2=caculatepointsDistance(points2[0],points2[1]);var dis=result2.offsetdistance-result1.offsetdistance;var ang=result2.angle-result1.angle;var sc=-dis/self.initdis/2;var mainresult={};mainresult.angle=-ang/Math.PI*180;mainresult.scale=sc;self.onrotate(mainresult);self.dispatchEvent(new Event("taprotate",mainresult))}function show(str){console.log(str+" is ready")}function caculatepointsDistance(point1,point2){var resultp={};var movex=point2.x-point1.x;var movey=point2.y-point1.y;var distance=Math.sqrt(movex*movex+movey*movey);var angle1,angle2,anglebe;angle1=Math.atan2(movey,movex);resultp.offsetx=movex;resultp.offsety=movey;resultp.offsetdistance=distance;resultp.angle=angle1;return resultp}this.element.addEventListener(MF_DEVICE.TOUCH_START,this.handleTouchBegin);this.element.addEventListener(MF_DEVICE.TOUCH_MOVE,this.handleTouchMove);this.element.addEventListener(MF_DEVICE.TOUCH_END,this.handleTouchEnd);document.addEventListener(MF_DEVICE.TOUCH_END,function(){self.element.removeEventListener(MF_DEVICE.TOUCH_MOVE,self.handleTouchMove)})}var MF_UTILS={getQuest:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(reg);if(r!=null){return r[2]}return null},isTel:function(mobile){return/^1[3|4|5|8] \d{9}$/.test(mobile)},trace:function(msg){console.log(msg)},discribeObject:function(object,bet){var str="";if(!bet)bet="";for(var o in object){str+=bet+o+":";if(object[o]instanceof Array){str+="[";str+=object[o];str+="]"+"\n"}else if(object[o]instanceof Object){var nbet=bet+"  ";str+="{\n";str+=this.discribeObject(object[o],nbet);str+=nbet+"}"+"\n"}else{str+=object[o]+"\n"}}return str},setCookie:function(name,value){var Days=30;var exp=new Date;exp.setTime(exp.getTime()+Days*24*60*60*1e3);document.cookie=name+"="+escape(value)+";expires="+exp.toGMTString()},getCookie:function(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");if(arr=document.cookie.match(reg))return unescape(arr[2]);else return null},delCookie:function(name){var exp=new Date;exp.setTime(exp.getTime()-1);var cval=getCookie(name);if(cval!=null)document.cookie=name+"="+cval+";expires="+exp.toGMTString()}};window.onhashchange=function(){var _h=window.location.hash.replace(/#/,"");if(_h in postTag){postTag[_h]["funname"](postTag[_h]["a"])}};var MF_postTag={addTag:function(n,fn,args){postTag[n]={funname:fn,a:args}},removeTag:function(n){if(n in postTag){delete postTag[n]}},start:function(){var _h=window.location.hash.replace(/#/,"");if(_h in this){var fun=this[_h]["funname"];fun(this[_h]["a"])}}};
